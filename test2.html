<!DOCTYPE html>
<html ng-app='app'>
<head lang="en">
	<meta charset="UTF-8">
	<title>test2</title>
	<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
	<script src="bower_components/lodash/dist/lodash.js"></script>
	<script src="bower_components/jquery/dist/jquery.js"></script>
	<!--<script src="bower_components/jquery-ui/jquery-ui.js"></script>-->
	<script src="bower_components/angular/angular.js"></script>
	<script src="bower_components/angular-animate/angular-animate.js"></script>
	<script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
	<style>
		body, html {height:100%;}
		body {padding: 30px;}
		.init {width: 100px; height: 100px; border:solid;}
		.elem {transition: 1s; border:solid; overflow:hidden;}
		.elem.ng-enter {opacity:0; height:0px;}
		.elem.ng-enter.ng-enter-active {opacity: 1; height:26px;}
		.elem.ng-leave {opacity:1; height:20px;}
		.elem.ng-leave.ng-leave-active {opacity: 1; height:0px; }
	</style>
</head>
<body ng-click="click()" ng-controller="ctrl">
<button ng-click="show = !show">click</button><br>
<div myif="show" class="elem">
	<div>insisde div</div>
</div>

<script>
var a = {name: 'dank'};
var b = a.clone;
var i;
	var app = angular.module('app', ['ngAnimate']);
	app.directive('myif', function($animate) {
		return {
			restrict: 'A',
			priority: 600,
			terminate: true,
			scope: true,
			transclude: 'element',
			link: function(scope, elem, attr, ctrl, trans) {
				var oldElem, oldScope;
				scope.$watch(attr.myif, function(val) {
					if(val) {
						trans(function(clone, scope) {
							oldElem = clone;
							clone[clone.length++] = document.createComment('myif-end');
							oldScope = scope;
							$animate.enter(clone, elem.parent(), elem);
						});
					}
					else {
						if(oldElem) {
							$animate.leave(oldElem).then(function() {
								console.log('elave')
								oldScope.$destroy();
								oldScope = null;
								oldElem = null;

							})
						}
					}
				})
			}
		}

	});
	app.controller('ctrl', function($scope, $animate){
		var promise, show;

		$scope.click = function() {
		}

	})
</script>
</body>
</html>